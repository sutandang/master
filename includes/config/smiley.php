<?php if ( ! defined('_VALID_BBC')) exit('No direct script access allowed');

define('smiley_dir', _ROOT.'includes/smiley/');
define('smiley_url', str_replace(_ROOT, _URL, smiley_dir));
$r_smiley = array (
  ':(' => 'sad.gif',
  ':-x' => 'love.gif',
  'X(' => 'angry.gif',
  ':-X' => 'love.gif',
  ':">' => 'blush.gif',
  'O=>' => 'male_fighter2.gif',
  '>:d<' => 'huggs.gif', 
  '0:-)' => 'angel.gif',
  '[-X' => 'shame.gif',
  'O:-)' => 'angel.gif',
  ':-D' => 'big_smile.gif',
  'O-+' => 'female_fighter.gif',
  'B-)' => 'sun_glas.gif',
  '#-O' => 'doh.gif',
  ':X' => 'love.gif',
  ':-p' => 'tongue.gif',
  ':-/' => 'question.gif',
  '#:-s' => 'sweating.gif',
  ':d' => 'big_smile.gif',
  '\\:d/' => 'dance.gif',
  'I-)' => 'sleep.gif',
  '~O)' => 'coffee.gif',
  '(:|' => 'tired.gif',
  '=p~' => 'drool.gif',
  ':-))' => 'laugh_loud.gif',
  'o->' => 'male_fighter1.gif',
  '*-:)' => 'idea.gif',
  '(%)' => 'ying_yang.gif',
  '3:-0' => 'cow.gif',
  ':-*' => 'kiss.gif',
  'o=>' => 'male_fighter2.gif',
  '3:-o' => 'cow.gif',
  ':x' => 'love.gif',
  '=P~' => 'drool.gif',
  ':-sS' => 'nail_biting.gif',
  '=:)' => 'alien.gif',
  ':|' => 'neutral.gif',
  'o:-)' => 'angel.gif',
  ':-(' => 'sad.gif',
  '(:' => 'smiley.gif',
  'x-(' => 'angry.gif',
  ':-P' => 'tongue.gif',
  ':-S' => 'worried.gif',
  '>:/' => 'waving.gif',
  '#:-S' => 'sweating.gif',
  'b-(' => 'beatup.gif',
  '$-)' => 'money_eyes.gif',
  ':-?' => 'think.gif',
  ':-j' => 'you_kidding_me.gif',
  ':o' => 'ooooh.gif',
  '^:)^' => 'worship.gif',
  ';-)' => 'wink.gif',
  ':^O' => 'liar.gif',
  '=;' => 'bye.gif',
  'o-+' => 'female_fighter.gif',
  'O->' => 'male_fighter1.gif',
  ':-l' => 'frustrated.gif',
  ':-&' => 'sick.gif',
  ':0)' => 'clown.gif',
  ':-s' => 'worried.gif',
  ':-\\' => 'question.gif',
  '8-X' => 'ghost.gif',
  ':-B' => 'glasses.gif',
  '/:-)' => 'eye_brow.gif',
  '~o)' => 'coffee.gif',
  '(~~)' => 'pumpkin.gif',
  '[-(' => 'silent.gif',
  '#-o' => 'doh.gif',
  ':-Ss' => 'nail_biting.gif',
  '[-x' => 'shame.gif',
  ':)' => 'smiley.gif',
  ':o)' => 'clown.gif',
  ':(|)' => 'monkey.gif',
  ':O' => 'ooooh.gif',
  ';;)' => 'batting.gif',
  ':-((' => 'cry.gif',
  'B-(' => 'beatup.gif',
  ':^o' => 'liar.gif',
  '(-:' => 'smiley.gif',
  '<:-p' => 'party.gif',
  'x(' => 'angry.gif',
  ':-b' => 'glasses.gif',
  ':-@' => 'talk_to_hand.gif',
  ':-o' => 'ooooh.gif',
  '/:)' => 'eye_brow.gif',
  ':))' => 'laugh_loud.gif',
  ':-W' => 'waiting.gif',
  ':->' => 'mean.gif',
  '|-)' => 'sleep.gif',
  ':D' => 'big_smile.gif',
  ':-ss' => 'nail_biting.gif',
  '@-)' => 'hypnotized.gif',
  '=d>' => 'clap.gif',
  ':-w' => 'waiting.gif',
  '<:-P' => 'party.gif',
  ':-$' => 'shhhh.gif',
  '~:>' => 'chicken.gif',
  ':-J' => 'you_kidding_me.gif',
  '(*)' => 'star.gif',
  '>:P' => 'mad_tongue.gif',
  '=:-)' => 'alien.gif',
  ':((' => 'cry.gif',
  '8-x' => 'ghost.gif',
  '>:p' => 'mad_tongue.gif',
  '=D>' => 'clap.gif',
  '>-)' => 'alien2.gif',
  ':-L' => 'frustrated.gif',
  '=((' => 'broken_heart.gif',
  ':-|' => 'neutral.gif',
  ':P' => 'tongue.gif',
  ':@)' => 'pig.gif',
  'l-)' => 'loser.gif',
  ':-)' => 'smiley.gif',
  ':O)' => 'clown.gif',
  ':)>-' => 'peace.gif',
  'L-)' => 'loser.gif',
  '3:-O' => 'cow.gif',
  '%%-' => 'sham_rock.gif',
  ':p' => 'tongue.gif',
  ':-"' => 'whistling.gif',
  ':-d' => 'big_smile.gif',
  ':-<' => 'sighing.gif',
  '\:D/' => 'dance.gif',
  '>:)' => 'devil.gif',
  '[-O<' => 'pray.gif',
  '8-|' => 'eye_roll.gif',
  '**==' => 'flag.gif',
  ':*' => 'kiss.gif',
  '8-}' => 'silly.gif',
  '=))' => 'rotfl.gif',
  'X-(' => 'angry.gif',
  'b-)' => 'sun_glas.gif',
  ':-O' => 'ooooh.gif',
  ':>' => 'mean.gif',
  ';)' => 'wink.gif',
  '<):)' => 'cowboy.gif',
  '>:D<' => 'huggs.gif',
  ':-SS' => 'nail_biting.gif',
  ';))' => 'giggle.gif',
  '@};-' => 'flower.gif',
  '[-o<' => 'pray.gif',
  ':)]' => 'on_phone.gif',
  ':-c' => 'call_me.gif',
  '~X(' => 'wit_send.gif',
  ':-h' => 'wave.gif',
  ':-t' => 'time_out.gif',
  '8->' => 'day_dream.gif',
  ':-??' => 'dont_know.gif',
  '%-(' => 'not_listening.gif'
);
$r_icon = array(
  'smiley.gif'
, 'sad.gif'
, 'wink.gif'
, 'big_smile.gif'
, 'batting.gif'
, 'huggs.gif'
, 'question.gif'
, 'love.gif'
, 'blush.gif'
, 'tongue.gif'
, 'kiss.gif'
, 'broken_heart.gif'
, 'ooooh.gif'
, 'angry.gif'
, 'mean.gif'
, 'sun_glas.gif'
, 'worried.gif'
, 'sweating.gif'
, 'devil.gif'
, 'cry.gif'
, 'laugh_loud.gif'
, 'neutral.gif'
, 'eye_brow.gif'
, 'rotfl.gif'
, 'angel.gif'
, 'glasses.gif'
, 'bye.gif'
, 'sleep.gif'
, 'eye_roll.gif'
, 'loser.gif'
, 'sick.gif'
, 'shhhh.gif'
, 'silent.gif'
, 'clown.gif'
, 'silly.gif'
, 'party.gif'
, 'tired.gif'
, 'drool.gif'
, 'think.gif'
, 'doh.gif'
, 'clap.gif'
, 'nail_biting.gif'
, 'hypnotized.gif'
, 'liar.gif'
, 'waiting.gif'
, 'sighing.gif'
, 'mad_tongue.gif'
, 'cowboy.gif'
, 'on_phone.gif'
, 'call_me.gif'
, 'wit_send.gif'
, 'wave.gif'
, 'time_out.gif'
, 'day_dream.gif'
);
function smiliescmp ($a, $b) {
	if (strlen($a) == strlen($b)) {
		return strcmp($a, $b);
	}
	return (strlen($a) > strlen($b)) ? -1 : 1;
}

function smileyencode ($smiley) {
	$arr = preg_split('//', $smiley, -1, PREG_SPLIT_NO_EMPTY);
	$out = '';
	foreach ($arr as $char) {
		$out .= "&#" . ord($char) . ";" ;
	}
	return $out;
}
uksort($r_smiley, 'smiliescmp');

$imagetosmilies = array();
foreach($r_smiley as $code => $img)
{
	$alt = str_replace('_', ' ', substr($img, 0, strrpos($img, '.'))).' '.urlencode($code);
	$image = '<img src="'.smiley_url.$img.'" title=\''.$alt.'\' class="smiley_image">';
	$imagetosmilies[$code] = $image;
}

$r = array();
foreach($imagetosmilies AS $code => $image) {
	$ln = strlen($code);
	$r[$ln][] = array($code, $image);
}
krsort($r);
reset($r);
$imagetosmilies = array();
foreach($r AS $data)
	foreach($data AS $dt)
		$imagetosmilies[$dt[0]] = $dt[1];

// GET ICONS...
$icontosmilies = array();
$r = array_flip($r_smiley);
foreach($r_icon AS $img) {
	if(isset($r[$img])) {
		$code = $r[$img];
		$alt	= str_replace('_', ' ', substr($img, 0, strrpos($img, '.'))).' '.$code;
		$image= '<img src="'.smiley_url.'icon/'.$img.'" title=\''.$alt.'\' rel=\''.$code.'\' class="smiley_icon" >';
		$icontosmilies[strtoupper($code)] = $image;
	}
}
$r_smiley = $imagetosmilies;
$r_smiley_icon = $icontosmilies;
